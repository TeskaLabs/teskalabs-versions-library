# Release Notes v25.28

## Patches

---

## Upgrade Procedure

**Upgrade path: v25.15 â†’ v25.28**

---

### Prerequisites

#### Elasticsearch
**Single Node OR Testing installation**

For single node and testing environemnts with low disk usage: proceed without additional precaution. Elasticsearch will be reconfigured and restarted during the upgrade. 

**Production installation**

First, reconfigure the Elasticsearch instances tier by tier. Then procceed with the upgrade. 
 1. Disable shard allocation:

In Dev Tools of Kibana, run this request:
```
PUT _cluster/settings
{
  "persistent": {
    "cluster.routing.allocation.enable": "primaries"
  }
}
```

2. Reconfigure Elasticsearch instances tier by tier.

- Start with cold nodes.
- Continue with warm, hot, then master nodes.
- Set the version in `model.yaml` for one instance at a time, e.g.:

```yaml
services:
  elasticsearch:
   instances:
     cold-1:
       descriptor:
	     environment:
		   action.auto_create_index: .monitoring*
       node: lmio-server-1
```

- Select current node (`lmio-server-1`) and hit **Apply** button.

**After reconfiguring a Elasticsearch instance**:
- Confirm the instance is up.
- Wait for the shard recovery and health status. _The cluster should recover from red state to yellow._
- Proceed with the next instance.

Once all instances are reconfigured, re-enable shard allocation. _The cluster should go from yellow to green._

```
PUT _cluster/settings
{
  "persistent": {
    "cluster.routing.allocation.enable": null
  }
}
```


#### Baseliners and Correlators
Make sure there's no lag in for `lmio-baseliner` and `lmio-correlator` consumer groups in Kafka. You can use our comprehensive _Kafka Lag Overview Dashboard_ in Grafana.

### Upgrade LogMan.io

1. Update versions in `Site/model.yaml`:

_Use the highest available patch version!_

```yaml
applications:
 - name: "ASAB Maestro"
   version: v25.28
 - name: "LogMan.io"
   version: v25.28
```

2. Apply the changes to each node in the cluster one by one, consecutivelly.

**OR**

On each node:

   * navigate to `/opt/site`
   * run `./gov.sh up`

3. After all nodes are updated, repeat `./gov.sh up` on each node to ensure service consistency.


### Post-upgrade Steps

#### Library

##### model.yaml
Remove configurations of Elasticsearch introduced before the upgrade. They are already part of the common content.

##### Complex Event Lanes
Complex eventlane definition is deprecated. 
Change the `define` section of the Complex eventlane to:
```
---
define:
  type: lmio/event-lane-complex
  name: Complex
```

##### Parsers
Some parsers were renamed.

**Edit paths in event lane if parsers from Common Library are used.**

- `Parsers/FileZilla/` --> `Parsers/FileZilla/pre_1_0/`
- `Parsers/NetApp/` --> `Parsers/NetApp/FAS`

##### Correlations
Some correlations were renamed.

**Adjust LMIO Correlator configurations in `/Site/model.yaml`:**

- `Correlations/Microsoft/Windows/Break Glass Account Used.yaml` --> `Correlations/Complex/Break Glass Account Used.yaml`
- `Correlations/Linux/Default Logins Linux.yaml` --> `Correlations/Complex/Default Logins.yaml`
- `Detections/System/High Number Of Errors.yaml` --> `Correlations/System/High Number Of Errors.yaml`

#### Elasticearch
**Perform rollover on indices corresponding with these eventlanes**:
- Cisco ISE
- HPE Aruba
- Microsoft SQL
- Microsoft Windows Events
- Complex

Use Dev Tools in Kibana.
```
POST lmio-<tenant>-events-<stream_name>/_rollover
```
Check the name of the index (rollover alias) with the Event Lane declaration.

#### LMIO Franz

LMIO Franz is a new service introduced in release `v25.28`. It manages data retention in Kafka.

Add `lmio-franz` service to the `model.yaml`:

```yaml
services:
  lmio-franz:
    - your-node
```

_Run lmio-franz as a single instance per cluster._

#### Kafka Consumers
`lmio-baseliner*` and `lmio-correlator*` consumer groups were renamed to `lmio_baseliner*` and `lmio_correlator*` consumer groups. Kafka will remeber the old names for several weeks and discard them eventually. 

There's no need for any additional steps about that unless it affects your monitoring.

If so, delete the old (`lmio-baseliner*` and `lmio-correlator*`) consumer groups. https://docs.teskalabs.com/logman.io/reference/kafka/commands/#deleting-the-consumer-group

---

## Technical changelogs <...>
